
# ğŸ“š collections æ¨¡å—ï¼ˆdequeã€defaultdictã€Counterï¼‰

## âœ¨ æ¨¡å—ç®€ä»‹

Python çš„ `collections` æ¨¡å—æ˜¯æ ‡å‡†åº“ä¸­éå¸¸å¼ºå¤§çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†å¤šä¸ªé«˜æ€§èƒ½æ•°æ®å®¹å™¨çš„å®ç°ï¼Œç”¨äºæ›¿ä»£æˆ–å¢å¼ºå†…ç½®çš„ `list`ã€`dict`ã€`tuple` ç­‰ç»“æ„ã€‚æœ¬ç« æˆ‘ä»¬é‡ç‚¹è®²è§£ä»¥ä¸‹ä¸‰ä¸ªï¼š

* `deque`ï¼šåŒç«¯é˜Ÿåˆ—ï¼Œé€‚åˆé«˜æ•ˆçš„é˜Ÿåˆ—å’Œæ ˆæ“ä½œ
* `defaultdict`ï¼šå¸¦æœ‰é»˜è®¤å€¼çš„å­—å…¸ï¼Œè§£å†³ KeyError é—®é¢˜
* `Counter`ï¼šç”¨äºè®¡æ•°çš„å­—å…¸å­ç±»ï¼Œå¸¸ç”¨äºé¢‘ç‡ç»Ÿè®¡

---

## ä¸€ã€dequeï¼šåŒç«¯é˜Ÿåˆ—

### âœ… åŸºæœ¬ç‰¹æ€§

* ç±»å‹ï¼š`collections.deque`
* ç”¨é€”ï¼šæ”¯æŒåœ¨ä¸¤ç«¯é«˜æ•ˆæ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼ˆO(1) å¤æ‚åº¦ï¼‰
* ä¼˜äº listï¼šlist åœ¨å¤´éƒ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ€§èƒ½è¾ƒå·®

### âœ… åˆ›å»ºæ–¹å¼

```python
from collections import deque

d = deque([1, 2, 3])
```

### âœ… å¸¸ç”¨æ“ä½œ

| æ–¹æ³•                 | åŠŸèƒ½æè¿°            |
| ------------------ | --------------- |
| `append(x)`        | å‘å³ä¾§æ·»åŠ å…ƒç´          |
| `appendleft(x)`    | å‘å·¦ä¾§æ·»åŠ å…ƒç´          |
| `pop()`            | ä»å³ä¾§åˆ é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´     |
| `popleft()`        | ä»å·¦ä¾§åˆ é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´     |
| `extend(iterable)` | ä»å³ä¾§æ‰©å±•å¤šä¸ªå…ƒç´        |
| `extendleft(iter)` | ä»å·¦ä¾§æ‰©å±•å¤šä¸ªå…ƒç´ ï¼ˆé€†åºï¼‰   |
| `rotate(n)`        | å‘å³æ—‹è½¬ n æ­¥ï¼ˆè´Ÿæ•°ä¸ºå·¦æ—‹ï¼‰ |
| `clear()`          | æ¸…ç©ºæ‰€æœ‰å…ƒç´           |

### âœ… ç¤ºä¾‹

```python
from collections import deque

q = deque([1, 2, 3])
q.append(4)           # [1, 2, 3, 4]
q.appendleft(0)       # [0, 1, 2, 3, 4]
q.pop()               # ç§»é™¤ 4
q.popleft()           # ç§»é™¤ 0
q.rotate(2)           # å‘å³æ—‹è½¬ä¸¤ä½
print(q)              # è¾“å‡ºæ—‹è½¬åçš„ç»“æœ
```

### âœ… ä½¿ç”¨åœºæ™¯

* å®ç°é˜Ÿåˆ—ã€æ ˆ
* æ»‘åŠ¨çª—å£ç®—æ³•
* ç¼“å­˜ç»“æ„ï¼ˆé…åˆ `maxlen` é™åˆ¶å®¹é‡ï¼‰

---

## äºŒã€defaultdictï¼šå¸¦é»˜è®¤å€¼çš„å­—å…¸

### âœ… åŸºæœ¬ç‰¹æ€§

* ç±»å‹ï¼š`collections.defaultdict`
* ç”¨é€”ï¼šåœ¨è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œé¿å… `KeyError`
* é»˜è®¤å€¼é€šè¿‡ä¼ å…¥ä¸€ä¸ªâ€œå·¥å‚å‡½æ•°â€æä¾›ï¼Œæ¯”å¦‚ `int`ã€`list`ã€`set`

### âœ… åˆ›å»ºæ–¹å¼

```python
from collections import defaultdict

d = defaultdict(int)       # é»˜è®¤å€¼ä¸º 0
d2 = defaultdict(list)     # é»˜è®¤å€¼ä¸º []
```

### âœ… ç¤ºä¾‹ä¸€ï¼šè‡ªåŠ¨ç»Ÿè®¡è®¡æ•°ï¼ˆintï¼‰

```python
count = defaultdict(int)
words = ["apple", "banana", "apple"]
for w in words:
    count[w] += 1
print(count["apple"])  # 2
print(count["orange"]) # 0ï¼Œä¸æŠ¥é”™
```

### âœ… ç¤ºä¾‹äºŒï¼šåˆ†ç±»å½’ç»„ï¼ˆlistï¼‰

```python
groups = defaultdict(list)
data = [("a", 1), ("b", 2), ("a", 3)]

for key, value in data:
    groups[key].append(value)

print(groups["a"])  # [1, 3]
print(groups["c"])  # []
```

### âœ… ä½¿ç”¨åœºæ™¯

* æ•°æ®å½’ç±»èšåˆ
* å•è¯é¢‘ç‡ç»Ÿè®¡
* é¿å…å¤§é‡ if åˆ¤æ–­çš„åˆå§‹åŒ–é€»è¾‘

---

## ä¸‰ã€Counterï¼šè®¡æ•°å™¨å·¥å…·ç±»

### âœ… åŸºæœ¬ç‰¹æ€§

* ç±»å‹ï¼š`collections.Counter`
* ç”¨é€”ï¼šç”¨äºç»Ÿè®¡å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œæ˜¯ `dict` çš„å­ç±»
* è‡ªåŠ¨è®¡æ•°ã€æ”¯æŒåŠ å‡é›†åˆ

### âœ… åˆ›å»ºæ–¹å¼

```python
from collections import Counter

c = Counter("banana")  # c = {'b':1, 'a':3, 'n':2}
```

### âœ… å¸¸ç”¨æ–¹æ³•

| æ–¹æ³•                   | åŠŸèƒ½æè¿°              |
| -------------------- | ----------------- |
| `most_common(n)`     | è¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„ n ä¸ªå…ƒç´    |
| `elements()`         | è¿”å›è®¡æ•°å™¨å±•å¼€çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆé‡å¤ï¼‰ |
| `subtract(iterable)` | ä»ç°æœ‰è®¡æ•°å™¨ä¸­å‡å»æ–°çš„è®¡æ•°å™¨å€¼   |
| `update(iterable)`   | å¢åŠ è®¡æ•°              |

### âœ… ç¤ºä¾‹ï¼šé¢‘ç‡ç»Ÿè®¡

```python
from collections import Counter

words = ["apple", "banana", "apple", "orange", "banana", "apple"]
counter = Counter(words)

print(counter["apple"])             # 3
print(counter.most_common(2))       # [('apple', 3), ('banana', 2)]
```

### âœ… ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²é¢‘ç‡å¯¹æ¯”

```python
c1 = Counter("apple")
c2 = Counter("plea")
diff = c1 - c2
print(diff)  # Counter({'p': 1})
```

### âœ… ä½¿ç”¨åœºæ™¯

* å­—ç¬¦ç»Ÿè®¡ï¼ˆå¦‚åˆ¤æ–­æ˜¯å¦ä¸ºâ€œå¼‚ä½è¯â€ï¼‰
* æ•°æ®æ¸…æ´—ä¸­å¿«é€Ÿè·å–é¢‘æ¬¡åˆ†å¸ƒ
* å®ç°æ’è¡Œæ¦œã€è®¡æ•°å™¨ã€åº“å­˜ç³»ç»Ÿç­‰

---

## âœ… æ€»ç»“

| å·¥å…·            | ç”¨é€”æ¦‚è¿°            | æ˜¯å¦å¯å˜ | æ˜¯å¦å†…ç½® |
| ------------- | --------------- | ---- | ---- |
| `deque`       | é«˜æ€§èƒ½åŒç«¯é˜Ÿåˆ—         | âœ…    | âŒ    |
| `defaultdict` | å¸¦é»˜è®¤å€¼çš„ dict      | âœ…    | âŒ    |
| `Counter`     | ç”¨äºé¢‘ç‡ç»Ÿè®¡çš„ dict å­ç±» | âœ…    | âŒ    |

---

## ğŸ“Œ å»¶ä¼¸é˜…è¯»å»ºè®®

* `namedtuple`ï¼šè®©å…ƒç»„åƒå¯¹è±¡ä¸€æ ·è®¿é—®å­—æ®µ
* `OrderedDict`ï¼šä¿æŒå­—å…¸æ’å…¥é¡ºåºï¼ˆPython 3.7+ å·²é»˜è®¤ï¼‰
* `ChainMap`ï¼šå¤šä¸ª dict çš„é€»è¾‘åˆå¹¶è§†å›¾

